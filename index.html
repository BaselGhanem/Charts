<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>X Academy - Excel Master Class</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'x-primary': '#107c41',
                        'x-primary-dark': '#0b5c30',
                        'x-secondary': '#fbbf24',
                        'x-light': '#f0fdf4',
                        'male-blue': '#3b82f6',
                        'female-pink': '#ec4899',
                        'gold': '#FFD700',
                    },
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'slide-in': 'slideIn 0.5s ease-out',
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'tada': 'tada 1s ease-out'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.9)' }, '100%': { transform: 'scale(1)' } },
                        slideIn: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } },
                        pulseGlow: { '0%, 100%': { opacity: '1', boxShadow: '0 0 5px rgba(16, 124, 65, 0.5)' }, '50%': { opacity: '0.8', boxShadow: '0 0 20px rgba(16, 124, 65, 0.8)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        tada: { '0%': { transform: 'scale(1)' }, '10%, 20%': { transform: 'scale(0.9) rotate(-3deg)' }, '30%, 50%, 70%, 90%': { transform: 'scale(1.1) rotate(3deg)' }, '40%, 60%, 80%': { transform: 'scale(1.1) rotate(-3deg)' }, '100%': { transform: 'scale(1) rotate(0)' } }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; overflow-x: hidden; scroll-behavior: smooth; }
        
        .gender-option {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .gender-option.selected {
            transform: scale(1.05);
            background-color: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .gender-option:hover { transform: translateY(-3px); }
        
        .gender-option[data-type="male"].selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .gender-option[data-type="male"].selected i { color: #3b82f6; }

        .gender-option[data-type="female"].selected {
            border-color: #ec4899;
            background-color: #fdf2f8;
        }
        .gender-option[data-type="female"].selected i { color: #ec4899; }

        .active-nav { 
            background-color: #107c41 !important; 
            color: white !important; 
            box-shadow: 0 4px 12px rgba(16, 124, 65, 0.3); 
        }

        .modal-overlay { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center; 
            z-index: 9999; animation: fadeIn 0.3s;
        }

        #toast-container {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 10000; display: flex; flex-direction: column; gap: 10px;
            pointer-events: none; width: 90%; max-width: 400px;
        }
        
        .toast { 
            background: white; padding: 12px 24px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex; align-items: center; gap: 12px;
            font-weight: bold; opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 1px solid #e5e7eb; transform: translateY(-20px);
            pointer-events: auto;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { border-right: 6px solid #107c41; color: #065f46; }
        .toast.error { border-right: 6px solid #ef4444; color: #991b1b; }

        .progress-ring__circle { transition: stroke-dashoffset 0.5s ease-in-out; transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        #certificate-content {
            background: white !important;
            color: #1f2937 !important;
            border: 8px double #107c41 !important;
        }
        .option-btn:hover { transform: scale(1.02); }
    </style>
</head>
<body class="min-h-screen flex flex-col pb-6">

    <div id="auth-modal" class="modal-overlay">
        <div class="bg-white p-6 md:p-8 rounded-3xl shadow-2xl max-w-md w-full text-center animate-pop relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-x-primary to-x-secondary"></div>
            
            <div class="mb-4 flex justify-center">
                <div class="bg-x-primary text-white w-16 h-16 rounded-xl flex items-center justify-center font-black text-3xl shadow-lg">X</div>
            </div>
            
            <h2 id="modal-title" class="text-2xl md:text-3xl font-black text-gray-800 mb-2 mt-2">ÿ£ŸáŸÑÿßŸã ÿ®ŸÉ ŸÅŸä X Academy</h2>
            <p id="modal-desc" class="text-gray-500 mb-6 text-sm">ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ ÿßÿÆÿ™ÿ± ÿ¥ÿÆÿµŸäÿ™ŸÉ Ÿàÿßÿ®ÿØÿ£ ÿßŸÑÿ±ÿ≠ŸÑÿ©</p>

            <form id="login-form" class="space-y-6">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="gender-option selected bg-gray-50 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 group" data-type="male" onclick="selectGender('male')">
                        <div class="w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center text-blue-500 group-hover:bg-blue-200 transition">
                            <i data-lucide="user" class="w-8 h-8"></i>
                        </div>
                        <span class="font-bold text-gray-600 group-hover:text-blue-600">ÿ¥ÿ®</span>
                    </div>

                    <div class="gender-option bg-gray-50 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 group" data-type="female" onclick="selectGender('female')">
                        <div class="w-14 h-14 rounded-full bg-pink-100 flex items-center justify-center text-pink-500 group-hover:bg-pink-200 transition">
                            <i data-lucide="user-circle" class="w-8 h-8"></i>
                        </div>
                        <span class="font-bold text-gray-600 group-hover:text-pink-600">ÿµÿ®Ÿäÿ©</span>
                    </div>
                </div>

                <div class="relative">
                    <input type="text" id="username-input" class="w-full p-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-x-primary focus:bg-white focus:ring-4 focus:ring-green-50 outline-none transition-all" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿ±ŸäŸÖ..." required autocomplete="off">
                </div>

                <button type="submit" id="start-btn" class="w-full bg-x-primary hover:bg-x-primary-dark text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 flex justify-center items-center gap-2">
                    <span id="start-btn-text">ŸäŸÑÿß ŸÜÿ®ŸÑÿ¥ ÿßŸÑÿ±ÿ≠ŸÑÿ©</span> <i data-lucide="arrow-left"></i>
                </button>
            </form>
        </div>
    </div>

    <div id="toast-container"></div>

    <header class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3 cursor-pointer" onclick="renderContent('hero')">
                    <div class="bg-gradient-to-br from-x-primary to-emerald-600 text-white w-9 h-9 md:w-10 md:h-10 rounded-lg flex items-center justify-center shadow-lg font-black text-lg md:text-xl">X</div>
                    <div class="flex flex-col">
                        <span class="font-black text-lg md:text-xl text-gray-800 tracking-tight leading-none">Academy</span>
                        <span class="text-[10px] md:text-xs font-bold text-x-primary tracking-wide">Excel Master</span>
                    </div>
                </div>

                <div class="flex items-center gap-2 md:gap-4">
                    <div id="user-display" class="hidden md:flex items-center gap-2 bg-green-50 px-4 py-1.5 rounded-full border border-green-100">
                    </div>
                    <button onclick="toggleLanguage()" class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 hover:bg-gray-50 text-sm font-bold text-gray-600 transition">
                        <i data-lucide="languages" class="w-4 h-4"></i> <span id="lang-btn">EN</span>
                    </button>
                    <button onclick="document.getElementById('mobile-menu-content').classList.toggle('hidden')" class="lg:hidden p-2 bg-gray-100 rounded-lg text-gray-600">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto w-full flex-grow flex flex-col lg:flex-row p-4 gap-6 mt-4">
        
        <aside class="w-full lg:w-72 bg-white rounded-2xl shadow-sm border border-gray-100 p-5 h-fit lg:sticky lg:top-24 flex flex-col gap-6">
            <div id="mobile-menu-content" class="hidden lg:flex flex-col gap-6">
                <div class="flex flex-col items-center justify-center relative py-2">
                    <div class="relative w-24 h-24 md:w-28 md:h-28">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="50%" cy="50%" r="45%" fill="none" stroke="#f1f5f9" stroke-width="8"/>
                            <circle id="progress-ring" cx="50%" cy="50%" r="45%" fill="none" stroke="#107c41" stroke-width="8" stroke-dasharray="301" stroke-dashoffset="301" stroke-linecap="round" class="transition-all duration-1000 ease-out"/>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="progress-percent" class="text-2xl font-black text-gray-800">0%</span>
                            <span id="progress-label" class="text-[10px] font-bold text-gray-400 uppercase">ÿ•ŸÜÿ¨ÿßÿ≤</span>
                        </div>
                    </div>
                    <div id="xp-display" class="text-xs text-x-secondary font-bold mt-2 hidden">XP: <span id="xp-value">0</span></div>
                </div>

                <nav id="nav-menu" class="space-y-2 flex-grow"></nav>

                <div id="achievements-section" class="pt-4 border-t border-gray-100 hidden">
                    <h3 class="font-bold text-xs mb-2 text-x-primary flex items-center gap-2"><i data-lucide="award" class="w-3"></i> ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™</h3>
                    <div id="achievements-list" class="space-y-2"></div>
                </div>
            </div>
        </aside>

        <main id="content-area" class="flex-grow bg-white rounded-2xl shadow-sm border border-gray-100 min-h-[60vh] p-4 md:p-8 animate-slide-in relative overflow-hidden">
        </main>

    </div>

    <div id="certificate-modal" style="display: none;" class="modal-overlay">
        <div id="certificate-content" class="bg-white p-10 rounded-xl max-w-3xl w-full text-center relative border-8 double border-x-primary shadow-2xl animate-pop">
            <button onclick="document.getElementById('certificate-modal').style.display = 'none'" data-html2canvas-ignore="true" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 transition"><i data-lucide="x-circle" class="w-8 h-8"></i></button>
            <div class="mb-6 flex justify-center">
                 <div class="bg-x-primary text-white w-16 h-16 rounded-xl flex items-center justify-center font-black text-3xl shadow-lg">X</div>
            </div>
            <h2 id="cert-header" class="text-3xl font-bold text-x-primary mb-2"></h2>
            <p id="cert-sub" class="text-lg text-gray-500 font-medium"></p>
            
            <h1 id="cert-name" class="text-5xl font-black text-gray-900 my-8 pb-2 border-b-4 border-x-secondary inline-block px-12"></h1>
            
            <p id="cert-desc" class="text-xl text-gray-600 leading-relaxed max-w-2xl mx-auto"></p>
            
            <div class="flex justify-center gap-8 my-8">
                <div class="text-center p-3 bg-green-50 rounded-lg">
                    <div class="w-10 h-10 rounded-full bg-x-primary text-white flex items-center justify-center mx-auto mb-2"><i data-lucide="sheet"></i></div>
                    <p class="text-xs font-bold text-x-primary">Multi-Sheets</p>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded-lg">
                    <div class="w-10 h-10 rounded-full bg-x-secondary text-white flex items-center justify-center mx-auto mb-2"><i data-lucide="bar-chart-3"></i></div>
                    <p class="text-xs font-bold text-yellow-600">Pro Charts</p>
                </div>
            </div>
            
            <div class="flex justify-between items-end border-t border-gray-200 pt-6 mt-4">
                <div class="text-right">
                    <p class="text-xs text-gray-400 font-bold mb-1">Date</p>
                    <p id="cert-date" class="text-sm font-bold text-gray-800 font-mono"></p>
                </div>
                <div class="text-left">
                    <p class="text-xs text-gray-400 font-bold mb-1">Instructor</p>
                    <p class="text-sm font-bold text-gray-800 font-mono">Basel Ghanem</p>
                </div>
            </div>

            <div class="flex gap-4 justify-center mt-8" data-html2canvas-ignore="true">
                <button onclick="downloadCertificate()" class="bg-x-primary hover:bg-x-primary-dark text-white font-bold py-3 px-8 rounded-xl flex items-center justify-center gap-2 transition hover:scale-105 shadow-lg">
                    <i data-lucide="download"></i> ÿ™ÿ≠ŸÖŸäŸÑ
                </button>
            </div>
        </div>
    </div>

    <div id="leaderboard-modal" style="display: none;" class="modal-overlay">
        <div class="bg-white p-6 rounded-2xl max-w-md w-full shadow-2xl animate-pop">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-x-primary flex items-center gap-2"><i data-lucide="trophy"></i> ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ</h3>
                <button onclick="document.getElementById('leaderboard-modal').style.display = 'none'" class="text-gray-400 hover:text-red-500"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="leaderboard-list" class="space-y-3"></div>
            <div class="mt-6 pt-6 border-t border-gray-200 flex justify-between items-center">
                <div>
                    <p class="font-bold text-sm text-gray-500">ÿ±ÿ™ÿ®ÿ™ŸÉ</p>
                    <p id="user-rank" class="text-2xl font-black text-x-primary">-</p>
                </div>
                <div id="user-score-display" class="text-right">
                    <p class="font-bold text-sm text-gray-500">ŸÜŸÇÿßÿ∑ŸÉ</p>
                    <p class="text-2xl font-black text-x-secondary">0</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            lang: 'ar',
            gender: 'male', 
            currentSection: 'hero',
            completedSections: new Set(),
            userName: null,
            tempSelection: null,
            xp: 0,
            achievements: new Set(),
            streak: 0,
            lastActivity: null,
            lessonCompletedMessages: new Set()
        };

        const t = {
            ar_male: {
                modal: { t: 'Ÿäÿß ŸáŸÑÿß ÿ®ŸäŸÉ Ÿäÿß ŸÖÿπŸÑŸÖ!', d: 'ÿπÿ¥ÿßŸÜ ŸÜÿ®ŸÑÿ¥ ÿ¥ÿ∫ŸÑ ÿßŸÑŸÖÿ≠ÿ™ÿ±ŸÅŸäŸÜÿå ÿ≥ÿ¨ŸÑ ÿßÿ≥ŸÖŸÉ.', p: 'ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿ±ŸäŸÖ..', b: 'ŸäŸÑÿß ŸÜÿ®ŸÑÿ¥ üöÄ' },
                hero: { 
                    title: 'Excel Master Class', 
                    sub: 'ÿ±ÿ≠ŸÑÿ© ÿ¥ÿßŸÖŸÑÿ©: ÿ™ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ + ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ©', 
                    welcome: 'ŸÜŸàÿ±ÿ™ Ÿäÿß', 
                    desc: 'ŸÅŸä ŸáÿßŸä ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿ±ÿ≠ ÿ™ÿ™ŸÇŸÜ ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑŸÄ Multi-Sheets Grouping Ÿàÿ±ÿ≠ ÿ™ÿ≠ÿ™ÿ±ŸÅ ÿßŸÑŸÄ Charts ŸàÿßŸÜŸàÿßÿπŸáÿß ÿßŸÑŸÄ 8.',
                    btn: 'ÿßÿ®ÿØÿ£ ÿßŸÑÿ±ÿ≠ŸÑÿ©', 
                    f1: 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅÿ≠ÿßÿ™', f1d: 'ÿ™ÿ≠ŸÉŸÖ ÿ®ŸÖŸÑŸÅ ŸÉÿßŸÖŸÑ ÿ®ŸÉÿ®ÿ≥ÿ© ÿ≤ÿ±.', 
                    f2: 'ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ©', f2d: 'ÿ≠ŸàŸÑ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ŸÑŸÇÿµÿµ ÿ®ÿµÿ±Ÿäÿ©.', 
                    f3: 'ÿ¥ŸáÿßÿØÿ© ÿ¥ÿßŸÖŸÑÿ©', f3d: 'ÿßÿ´ÿ®ÿ™ ŸÖŸáÿßÿ±ÿ™ŸÉ ŸÅŸä ÿßŸÑŸÖÿ¨ÿßŸÑŸäŸÜ.',
                    leaderboard: 'ŸÑŸàÿ≠ÿ© ÿßŸÑŸàÿ≠Ÿàÿ¥', stats: 'ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ŸÉ'
                },
                nav: { hero: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©', p1: 'ŸÇÿ≥ŸÖ 1: ÿ™ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™', p2: 'ŸÇÿ≥ŸÖ 2: ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ©', quiz: 'ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä' },
                lessons: {},
                common: {
                    progress: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤', lesson: 'ÿØÿ±ÿ≥', learn: 'ÿ¥Ÿà ÿ±ÿ≠ ÿ™ÿ™ÿπŸÑŸÖÿü', task: 'ÿßŸÑÿ™ÿ≠ÿØŸä', taskSub: 'ÿ∑ÿ®ŸÇ ÿßŸÑŸÑŸä ÿ™ÿπŸÑŸÖÿ™Ÿá', 
                    scenario: 'ÿßŸÑÿ≥ŸäŸÜÿßÿ±ŸäŸà:', choose: 'ÿßŸÑÿ≠ŸÑ ÿßŸÑÿ£ŸÜÿ≥ÿ®:', placeholder: 'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿ±ÿ≠ ÿ™ÿ∏Ÿáÿ± ŸáŸàŸÜ..', 
                    check: 'ÿ™ÿ≠ŸÇŸÇ', next: 'ÿßŸÑÿ™ÿßŸÑŸä', submit: 'ÿ≥ŸÑŸÖ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±',
                    correct: 'ŸÉŸÅŸà! ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©.', wrong: 'ÿ±ŸÉÿ≤ ÿ¥ŸàŸä.. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ´ÿßŸÜŸäÿ©.',
                    cert: { h: 'ÿ¥ŸáÿßÿØÿ© ÿ•ÿ™ŸÇÿßŸÜ', s: 'ÿ™ÿ¥ŸáÿØ X Academy ÿ®ÿ£ŸÜ', d: 'ÿ£ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿØŸàÿ±ÿ© Excel & Charts ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©.' },
                    realExample: 'ŸÖÿ´ÿßŸÑ ŸàÿßŸÇÿπŸä', extraTip: 'ÿ™ŸÑŸÖŸäÿ≠ ÿ•ÿ∂ÿßŸÅŸä',
                    achievements: {
                        firstBlood: { name: 'ÿßŸÑÿ∂ÿ±ÿ®ÿ© ÿßŸÑÿ£ŸàŸÑŸâ', desc: 'ÿ£ŸÉŸÖŸÑÿ™ ÿ£ŸàŸÑ ÿØÿ±ÿ≥' },
                        excelMaster: { name: 'ÿ≥ÿßÿ≠ÿ± ÿßŸÑÿ•ŸÉÿ≥ŸÑ', desc: 'ÿ£ŸÜŸáŸäÿ™ ŸÇÿ≥ŸÖ Excel' },
                        chartWizard: { name: 'ŸÅŸÜÿßŸÜ ÿßŸÑÿ±ÿ≥ŸàŸÖ', desc: 'ÿ£ŸÜŸáŸäÿ™ ŸÇÿ≥ŸÖ Charts' },
                        perfectScore: { name: 'ÿßŸÑÿπŸÑÿßŸÖÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ©', desc: 'ÿ¨ÿ®ÿ™ 100% ÿ®ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±' },
                        speedDemon: { name: 'ÿ≥ÿ±Ÿäÿπ ŸÉÿßŸÑÿ®ÿ±ŸÇ', desc: 'ÿ£ŸÜŸáŸäÿ™ 3 ÿØÿ±Ÿàÿ≥ ÿ®ÿ≥ÿ±ÿπÿ©' }
                    }
                },
                quiz: { t: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖÿπŸÑŸÖŸäŸÜ ÿßŸÑŸÜŸáÿßÿ¶Ÿä' }
            },
            ar_female: {
                modal: { t: 'Ÿäÿß ŸáŸÑÿß ÿ®ŸäŸÉŸä Ÿäÿß ŸÖÿπŸÑŸÖÿ©!', d: 'ÿπÿ¥ÿßŸÜ ŸÜÿ®ŸÑÿ¥ ÿ¥ÿ∫ŸÑ ÿßŸÑŸÖÿ≠ÿ™ÿ±ŸÅÿßÿ™ÿå ÿ≥ÿ¨ŸÑŸä ÿßÿ≥ŸÖŸÉ.', p: 'ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿ±ŸäŸÖ..', b: 'ŸäŸÑÿß ŸÜÿ®ŸÑÿ¥ üöÄ' },
                hero: { 
                    title: 'Excel Master Class', 
                    sub: 'ÿ±ÿ≠ŸÑÿ© ÿ¥ÿßŸÖŸÑÿ©: ÿ™ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ + ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ©', 
                    welcome: 'ŸÜŸàÿ±ÿ™Ÿä Ÿäÿß', 
                    desc: 'ŸÅŸä ŸáÿßŸä ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿ±ÿ≠ ÿ™ÿ™ŸÇŸÜŸä ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑŸÄ Multi-Sheets Grouping Ÿàÿ±ÿ≠ ÿ™ÿ≠ÿ™ÿ±ŸÅŸä ÿßŸÑŸÄ Charts ŸàÿßŸÜŸàÿßÿπŸáÿß ÿßŸÑŸÄ 8.',
                    btn: 'ÿßÿ®ÿØÿ¶Ÿä ÿßŸÑÿ±ÿ≠ŸÑÿ©', 
                    f1: 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅÿ≠ÿßÿ™', f1d: 'ÿ™ÿ≠ŸÉŸÖŸä ÿ®ŸÖŸÑŸÅ ŸÉÿßŸÖŸÑ ÿ®ŸÉÿ®ÿ≥ÿ© ÿ≤ÿ±.', 
                    f2: 'ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ©', f2d: 'ÿ≠ŸàŸÑŸä ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ŸÑŸÇÿµÿµ ÿ®ÿµÿ±Ÿäÿ©.', 
                    f3: 'ÿ¥ŸáÿßÿØÿ© ÿ¥ÿßŸÖŸÑÿ©', f3d: 'ÿßÿ´ÿ®ÿ™Ÿä ŸÖŸáÿßÿ±ÿ™ŸÉ ŸÅŸä ÿßŸÑŸÖÿ¨ÿßŸÑŸäŸÜ.',
                    leaderboard: 'ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ÿßÿ™', stats: 'ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ŸÉ'
                },
                nav: { hero: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©', p1: 'ŸÇÿ≥ŸÖ 1: ÿ™ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™', p2: 'ŸÇÿ≥ŸÖ 2: ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ©', quiz: 'ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä' },
                lessons: {},
                common: {
                    progress: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤', lesson: 'ÿØÿ±ÿ≥', learn: 'ÿ¥Ÿà ÿ±ÿ≠ ÿ™ÿ™ÿπŸÑŸÖŸäÿü', task: 'ÿßŸÑÿ™ÿ≠ÿØŸä', taskSub: 'ÿ∑ÿ®ŸÇŸä ÿßŸÑŸÑŸä ÿ™ÿπŸÑŸÖÿ™ŸäŸá', 
                    scenario: 'ÿßŸÑÿ≥ŸäŸÜÿßÿ±ŸäŸà:', choose: 'ÿßŸÑÿ≠ŸÑ ÿßŸÑÿ£ŸÜÿ≥ÿ®:', placeholder: 'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿ±ÿ≠ ÿ™ÿ∏Ÿáÿ± ŸáŸàŸÜ..', 
                    check: 'ÿ™ÿ≠ŸÇŸÇ', next: 'ÿßŸÑÿ™ÿßŸÑŸä', submit: 'ÿ≥ŸÑŸÖŸä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±',
                    correct: 'ŸÖÿ®ÿØÿπÿ©! ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©.', wrong: 'ÿ±ŸÉÿ≤Ÿä ÿ¥ŸàŸä.. ÿ≠ÿßŸàŸÑŸä ŸÖÿ±ÿ© ÿ´ÿßŸÜŸäÿ©.',
                    cert: { h: 'ÿ¥ŸáÿßÿØÿ© ÿ•ÿ™ŸÇÿßŸÜ', s: 'ÿ™ÿ¥ŸáÿØ X Academy ÿ®ÿ£ŸÜ', d: 'ÿ£ÿ™ŸÖÿ™ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿØŸàÿ±ÿ© Excel & Charts ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©.' },
                    realExample: 'ŸÖÿ´ÿßŸÑ ŸàÿßŸÇÿπŸä', extraTip: 'ÿ™ŸÑŸÖŸäÿ≠ ÿ•ÿ∂ÿßŸÅŸä',
                    achievements: {
                        firstBlood: { name: 'ÿßŸÑÿ®ÿØÿßŸäÿ© ÿßŸÑŸÇŸàŸäÿ©', desc: 'ÿ£ŸÉŸÖŸÑÿ™Ÿä ÿ£ŸàŸÑ ÿØÿ±ÿ≥' },
                        excelMaster: { name: 'ÿ≥ÿßÿ≠ÿ±ÿ© ÿßŸÑÿ•ŸÉÿ≥ŸÑ', desc: 'ÿ£ŸÜŸáŸäÿ™Ÿä ŸÇÿ≥ŸÖ Excel' },
                        chartWizard: { name: 'ŸÅŸÜÿßŸÜÿ© ÿßŸÑÿ±ÿ≥ŸàŸÖ', desc: 'ÿ£ŸÜŸáŸäÿ™Ÿä ŸÇÿ≥ŸÖ Charts' },
                        perfectScore: { name: 'ÿßŸÑÿπŸÑÿßŸÖÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ©', desc: 'ÿ¨ÿ®ÿ™Ÿä 100% ÿ®ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±' },
                        speedDemon: { name: 'ÿ≥ÿ±Ÿäÿπÿ© ŸÉÿßŸÑÿ®ÿ±ŸÇ', desc: 'ÿ£ŸÜŸáŸäÿ™Ÿä 3 ÿØÿ±Ÿàÿ≥ ÿ®ÿ≥ÿ±ÿπÿ©' }
                    }
                },
                quiz: { t: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖÿπŸÑŸÖÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿä' }
            },
            en: {
                modal: { t: 'Welcome!', d: 'Enter your name to start.', p: 'Your Name...', b: 'Let\'s Start üöÄ' },
                hero: { title: 'Excel Master Class', sub: 'Comprehensive: Multi-Sheets + Charts', welcome: 'Welcome', desc: 'Master Multi-Sheet Grouping logic and visualize data professionally with 8 chart types.', btn: 'Start Course', f1: 'Sheet Management', f1d: 'Control entire workbook instantly.', f2: 'Data Viz', f2d: 'Turn numbers into stories.', f3: 'Certificate', f3d: 'Prove your dual skills.', leaderboard: 'Leaderboard', stats: 'Your Stats' },
                nav: { hero: 'Home', p1: 'Part 1: Multi-Sheets', p2: 'Part 2: Charts', quiz: 'Final Quiz' },
                common: { progress: 'Progress', lesson: 'Lesson', learn: 'Concepts', task: 'Challenge', taskSub: 'Apply your skills', scenario: 'Scenario:', choose: 'Best Action:', placeholder: 'Result appears here..', check: 'Verify', next: 'Next', submit: 'Submit Quiz', correct: 'Correct! Great job.', wrong: 'Incorrect. Try again.', cert: { h: 'Certificate of Mastery', s: 'X Academy Certifies', d: 'Mastered Excel & Charts' }, realExample: 'Real World Example', extraTip: 'Extra Tip', achievements: { firstBlood: { name: 'First Blood', desc: 'Complete first lesson' }, excelMaster: { name: 'Excel Wizard', desc: 'Complete Excel section' }, chartWizard: { name: 'Chart Wizard', desc: 'Complete Charts section' }, perfectScore: { name: 'Perfect Score', desc: 'Get 100% on final quiz' }, speedDemon: { name: 'Speed Demon', desc: 'Complete 3 lessons in under 5 minutes' } } },
                quiz: { t: 'Comprehensive Final Quiz' }
            }
        };

        const lessonsBase = {
            'grouping': { t: 'ÿßŸÑÿ™ÿ≠ÿØŸäÿØ (Ctrl & Select)', d: 'ÿ™ÿπÿØŸäŸÑ 5 ÿ¥ŸáŸàÿ± ÿ®ŸÉÿ®ÿ≥ÿ© Ÿàÿßÿ≠ÿØÿ©.', p: ['Ctrl + Click ŸÑÿ™ÿ≠ÿØŸäÿØ ÿµŸÅÿ≠ÿßÿ™.', 'ÿ™ŸÉÿ™ÿ® ÿßŸÑŸÖÿπÿßÿØŸÑÿ© ŸÖÿ±ÿ©ÿå ÿ®ÿ™ŸÜŸÉÿ™ÿ® ÿπŸÜÿØ ÿßŸÑŸÉŸÑ.', 'Shift + Click ŸÑÿ™ÿ≠ÿØŸäÿØ ŸÜÿ∑ÿßŸÇ ÿµŸÅÿ≠ÿßÿ™.', 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿ¨ŸÖÿßÿπŸä Ÿäÿ∏Ÿáÿ± ÿ®ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿπŸÜŸàÿßŸÜ.'], s: 'ÿ®ÿØŸÉ ÿ™ÿ∂ŸäŸÅ ŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™ ŸÑŸÄ 3 ÿ¥ŸáŸàÿ± ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©.', o: ['ŸÜÿ≥ÿÆ ŸàŸÑÿµŸÇ', 'Ctrl + Grouping', 'ŸÉÿ™ÿßÿ®ÿ© ŸäÿØŸàŸäÿ©'], realExample: 'ÿ¥ÿ±ŸÉÿ©: ÿ™ÿπÿØŸäŸÑ ÿ£ÿ≥ÿπÿßÿ± 50 ŸÖŸÜÿ™ÿ¨ ŸÅŸä 12 ŸÅÿ±ÿπ ÿØŸÅÿπÿ© Ÿàÿßÿ≠ÿØÿ©.', extra: 'ÿ¨ÿ±ÿ®: ÿßÿ∂ÿ∫ÿ∑ Ctrl ŸàÿßÿÆÿ™ÿ± ÿµŸÅÿ≠ÿßÿ™ Jan ŸàFeb ŸàMar ŸÖÿπÿßŸã' },
            'formatting': { t: 'ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ (Select All)', d: 'ÿ™Ÿàÿ≠ŸäÿØ ÿ£ŸÑŸàÿßŸÜ Ÿàÿ≠ÿØŸàÿØ 20 ÿµŸÅÿ≠ÿ©.', p: ['Right Click -> Select All Sheets.', 'ÿ£Ÿä ÿ™ŸÜÿ≥ŸäŸÇ ÿ®ÿ™ÿπŸÖŸÑŸá ÿ®ŸÜÿ≥ÿÆ ŸÑŸÑŸÉŸÑ ŸÅŸàÿ±ÿßŸã.', 'Format Painter ŸäÿπŸÖŸÑ ŸÖÿπ Grouping.', 'ÿ™ÿπÿØŸäŸÑ Column Width ŸÑŸÑŸÉŸÑ ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©.'], s: 'ŸÖÿØŸäÿ±ŸÉ ÿ∑ŸÑÿ® ÿ™ŸÑŸàŸäŸÜ ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ŸàÿπŸÖŸÑ Borders ŸÑŸÑŸÉŸÑ.', o: ['Select All & Format', 'Macro', 'Ÿàÿßÿ≠ÿØ Ÿàÿßÿ≠ÿØ'], realExample: 'ÿ®ŸÜŸÉ: ÿ™Ÿàÿ≠ŸäÿØ ÿ™ŸÇÿßÿ±Ÿäÿ± 30 ŸÅÿ±ÿπ ŸÑÿ£ŸÑŸàÿßŸÜ ŸàÿÆÿ∑Ÿàÿ∑ ŸÖŸàÿ≠ÿØÿ©.', extra: 'ÿ™ŸÑŸÖŸäÿ≠: ÿ®ÿπÿØ Select Allÿå ÿ∫Ÿäÿ± ŸÑŸàŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ© Ÿàÿ¥ŸàŸÅ ÿßŸÑÿ™ÿ∫ŸäŸäÿ± ÿ®ŸÉŸÑ ÿßŸÑÿµŸÅÿ≠ÿßÿ™' },
            'formulas': { t: 'ÿßŸÑÿ¨ŸÖÿπ ÿ´ŸÑÿßÿ´Ÿä ÿßŸÑÿ£ÿ®ÿπÿßÿØ', d: 'ŸÖÿπÿßÿØŸÑÿ© Ÿàÿ≠ÿØÿ© ÿ®ÿ™ÿÆÿ™ÿ±ŸÇ ÿßŸÑÿµŸÅÿ≠ÿßÿ™.', p: ['Sum(First:Last!Cell)', 'ÿ™ÿ¨ŸÖÿπ ŸÜŸÅÿ≥ ÿßŸÑÿÆŸÑŸäÿ© ŸÖŸÜ ŸÉŸÑ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸÑŸä ÿ®ÿßŸÑŸÜÿµ.', 'ÿ™ÿπŸÖŸÑ ŸÖÿπ Average, Max, Min ÿ£Ÿäÿ∂ÿßŸã.', 'ÿßŸÑÿÆŸÑÿßŸäÿß ÿßŸÑŸÖÿØŸÖÿ¨ÿ© ÿ™ÿ∏Ÿáÿ± ÿ®ÿ™ŸÜÿ≥ŸäŸÇ ÿÆÿßÿµ.'], s: 'ÿ®ÿµŸÅÿ≠ÿ© Summaryÿå ÿ®ÿØŸÉ ŸÖÿ¨ŸÖŸàÿπ C18 ŸÖŸÜ Jan ŸÑŸÄ Mar.', o: ['Jan+Feb+..', 'Sum(Jan:Mar!C18)', 'Consolidate'], realExample: 'ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ: ŸÖÿ™ÿßÿ®ÿπÿ© ÿ•Ÿäÿ±ÿßÿØÿßÿ™ 12 ÿ¥Ÿáÿ± ÿ®ŸÄ ŸÖÿπÿßÿØŸÑÿ© Ÿàÿ≠ÿØÿ©.', extra: 'ÿßÿ≥ÿ™ÿÆÿØŸÖ: =AVERAGE(Jan:Dec!B5) ŸÑŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™ ÿßŸÑÿ≥ŸÜŸàŸäÿ©' },
            'safety': { t: 'ÿ™ŸÜÿ®ŸäŸá ÿßŸÑÿ£ŸÖÿßŸÜ', d: 'ÿÆÿ∑ÿ± ÿßŸÑŸÜÿ≥ŸäÿßŸÜ!', p: ['ÿ®ÿ≥ ÿ™ÿÆŸÑÿµÿå ŸÑÿßÿ≤ŸÖ ÿ™ÿπŸÖŸÑ Ungroup.', 'ÿßÿ∞ÿß ŸÜÿ≥Ÿäÿ™ÿå ÿ±ÿ≠ ÿ™ÿÆÿ±ÿ® ÿØÿßÿ™ÿß ÿ®ÿµŸÅÿ≠ÿßÿ™ ÿ´ÿßŸÜŸäÿ©.', 'ÿßŸÑŸÖÿ§ÿ¥ÿ± Ÿäÿ∏Ÿáÿ± Group Mode.', 'ÿ™ŸÜÿ®ŸäŸá Excel Ÿäÿ∏Ÿáÿ± ÿπŸÜÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ.'], s: 'ÿÆŸÑÿµÿ™ ÿ¥ÿ∫ŸÑ ÿ¨ŸÖÿßÿπŸä Ÿàÿ®ÿØŸÉ ÿ™ÿπÿØŸÑ ÿ®ÿ≥ ÿπŸÑŸâ Jan.', o: ['ÿ®ÿπÿØŸÑ ŸÅŸàÿ±ÿßŸã', 'Ungroup First', 'ÿ≥ŸÉÿ± ÿßŸÑŸÖŸÑŸÅ'], realExample: 'ÿ¥ÿ±ŸÉÿ© ÿ™ÿ£ŸÖŸäŸÜ: ÿÆÿ≥ÿßÿ±ÿ© 5000 ÿ≥ÿ¨ŸÑ ÿ®ÿ≥ÿ®ÿ® ŸÜÿ≥ŸäÿßŸÜ Ungroup.', extra: 'ÿßŸÜÿ™ÿ®Ÿá: ÿßŸÑÿπŸÜŸàÿßŸÜ Ÿäÿ∏Ÿáÿ± [Group] ÿπŸÜÿØ ÿßŸÑÿ™ÿ¨ŸÖŸäÿπ - ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿ≤ÿßŸÑÿ™Ÿá' },
            'comparison': { t: 'ÿßŸÑŸÖŸÇÿßÿ±ŸÜÿßÿ™', d: 'ŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑŸÇŸäŸÖ ÿ®ŸäŸÜ ŸÅÿ¶ÿßÿ™.', p: ['Column: ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑÿπŸÖŸàÿØŸäÿ©.', 'Bar: ÿßÿ∞ÿß ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ÿ∑ŸàŸäŸÑÿ©.', 'ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ£ŸÑŸàÿßŸÜ ŸÖÿ™ÿ®ÿßŸäŸÜÿ© ŸÑŸÑÿ™ŸÖŸäŸäÿ≤.', 'ÿ£ÿ∂ŸÅ Data Labels ŸÑŸÑŸàÿ∂Ÿàÿ≠.'], s: 'ŸÖŸÇÿßÿ±ŸÜÿ© ŸÖÿ®Ÿäÿπÿßÿ™ 3 ŸÖŸÜÿ™ÿ¨ÿßÿ™ (A, B, C) ŸÑŸÖÿπÿ±ŸÅÿ© ÿßŸÑÿ£ŸÅÿ∂ŸÑ.', o: ['Column', 'Line', 'Pie'], dataLabels: ['ÿ£', 'ÿ®', 'ÿ¨'], realExample: 'ŸÖÿ™ÿ¨ÿ± ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä: ŸÖŸÇÿßÿ±ŸÜÿ© ŸÖÿ®Ÿäÿπÿßÿ™ 10 ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ¥Ÿáÿ±ŸäÿßŸã.', extra: 'ŸÖÿ™ŸÇÿØŸÖ: ÿßÿ≥ÿ™ÿÆÿØŸÖ Clustered Column ŸÑŸÖŸÇÿßÿ±ŸÜÿ© ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿπÿ®ÿ± ŸÅÿ™ÿ±ÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ©' },
            'trends': { t: 'ÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™ (ÿßŸÑÿ≤ŸÖŸÜ)', d: 'ŸÉŸäŸÅ ÿßŸÑŸàÿ∂ÿπ ÿ®ÿ™ÿ∫Ÿäÿ± ŸÖÿπ ÿßŸÑŸàŸÇÿ™ÿü', p: ['Line: ŸÑÿ±ÿ§Ÿäÿ© ÿßŸÑÿµÿπŸàÿØ ŸàÿßŸÑŸáÿ®Ÿàÿ∑.', 'Area: ŸÑÿ™Ÿàÿ∂Ÿäÿ≠ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±.', 'ÿ£ÿ∂ŸÅ Trendline ŸÑŸÑÿ™ŸÜÿ®ÿ§.', 'ÿßÿ≥ÿ™ÿÆÿØŸÖ Markers ŸÑŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖŸáŸÖÿ©.'], s: 'ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ÿ®ÿ¢ÿÆÿ± 5 ÿ¥ŸáŸàÿ± (ÿßÿ™ÿ¨ÿßŸá ÿπÿßŸÖ).', o: ['Pie', 'Bar', 'Line'], dataLabels: ['ŸäŸÜÿßŸäÿ±','ŸÅÿ®ÿ±ÿßŸäÿ±','ŸÖÿßÿ±ÿ≥','ÿ£ÿ®ÿ±ŸäŸÑ','ŸÖÿßŸäŸà'], realExample: 'ÿ®Ÿàÿ±ÿµÿ©: ÿ™ÿ™ÿ®ÿπ ÿ≥ŸáŸÖ ÿ¥ÿ±ŸÉÿ© ÿπŸÑŸâ ŸÖÿØŸâ ÿ≥ŸÜÿ©.', extra: 'ÿ¨ÿ±ÿ®: ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ÿßŸÑÿÆÿ∑ ŸÑÿ±ÿ§Ÿäÿ© ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©' },
            'proportions': { t: 'ÿßŸÑŸÜÿ≥ÿ® (ÿßŸÑÿ£ÿ¨ÿ≤ÿßÿ°)', d: 'ÿ≠ÿµÿ© ŸÉŸÑ Ÿàÿßÿ≠ÿØ ŸÖŸÜ ÿßŸÑŸÉÿπŸÉÿ©.', p: ['Pie: ŸÑŸÑÿ£ÿ¨ÿ≤ÿßÿ° ŸÖŸÜ ÿßŸÑŸÉŸÑ (%).', 'ŸÑÿß ÿ™ÿ≥ÿ™ÿÆÿØŸÖŸáÿß ÿßÿ∞ÿß ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ > 7.', 'Doughnut: ŸÜÿ≥ÿÆÿ© ŸÖÿ™ŸÇÿØŸÖÿ© ŸÖŸÜ Pie.', 'ÿßÿ≥ÿ™ÿÆÿØŸÖ Explode slice ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ.'], s: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© (50% ÿ±Ÿàÿßÿ™ÿ®ÿå 30% ÿ™ÿ≥ŸàŸäŸÇ..).', o: ['Radar', 'Pie', 'Scatter'], dataLabels: ['ÿ±Ÿàÿßÿ™ÿ®','ÿ™ÿ≥ŸàŸäŸÇ','ÿ™ÿ¥ÿ∫ŸäŸÑ'], realExample: 'ÿ¥ÿ±ŸÉÿ© ŸÜÿßÿ¥ÿ¶ÿ©: ÿ™Ÿàÿ≤Ÿäÿπ ÿ±ÿ£ÿ≥ ÿßŸÑŸÖÿßŸÑ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ.', extra: 'ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä: ÿßÿ≥ÿ™ÿÆÿØŸÖ Pie of Pie ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©' },
            'relationships': { t: 'ÿßŸÑÿπŸÑÿßŸÇÿßÿ™ ÿßŸÑŸÖÿπŸÇÿØÿ©', d: 'ÿ™ŸÇŸäŸäŸÖ ÿÆÿµÿßÿ¶ÿµ ŸÖÿ™ÿπÿØÿØÿ©.', p: ['Radar: ŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖŸáÿßÿ±ÿßÿ™ (ÿ¥ÿ®ŸÉÿ© ÿßŸÑÿπŸÜŸÉÿ®Ÿàÿ™).', 'Scatter: ŸÑŸÑÿπŸÑÿßŸÇÿ© ÿ®ŸäŸÜ ŸÖÿ™ÿ∫Ÿäÿ±ŸäŸÜ.', 'Bubble: ÿ´ŸÑÿßÿ´ ÿ£ÿ®ÿπÿßÿØ (X, Y, Size).', 'Heatmap: ŸÉÿ´ÿßŸÅÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.'], s: 'ÿ™ŸÇŸäŸäŸÖ ŸÖŸàÿ∏ŸÅ ÿ®ŸÄ 5 ŸÖŸáÿßÿ±ÿßÿ™ (ÿ™ŸàÿßÿµŸÑÿå ÿ™ŸÇŸÜŸäÿ©ÿå ÿßŸÑÿ™ÿ≤ÿßŸÖ..).', o: ['Radar', 'Line', 'Column'], dataLabels: ['ÿ™ŸàÿßÿµŸÑ','ÿ™ŸÇŸÜŸäÿ©','ŸÅÿ±ŸäŸÇ','ŸàŸÇÿ™','ÿπŸÖŸÑ'], realExample: 'ŸÖŸàÿßÿ±ÿØ ÿ®ÿ¥ÿ±Ÿäÿ©: ŸÖŸÇÿßÿ±ŸÜÿ© ÿ£ÿØÿßÿ° 50 ŸÖŸàÿ∏ŸÅ ÿ®ŸÄ 8 ŸÖÿπÿßŸäŸäÿ±.', extra: 'ÿ™ŸÅÿßÿπŸÑŸä: ÿ≠ÿ±ŸÉ ŸÜŸÇÿßÿ∑ ÿßŸÑŸÄ Scatter ŸÑÿ™ÿ±Ÿâ ÿßŸÑÿπŸÑÿßŸÇÿ© ÿ™ÿ™ÿ∫Ÿäÿ±' }
        };

        t.ar_male.lessons = lessonsBase;
        t.ar_female.lessons = lessonsBase;
        
        const enLessons = {
            'grouping': { t: 'Grouping (Ctrl)', d: 'Edit 5 months in one click.', p: ['Ctrl + Click sheets.', 'Write formula once.', 'Shift + Click range.', 'Group mode title.'], s: 'SUM sales for 3 months at once.', o: ['Copy Paste', 'Ctrl + Grouping', 'Manual'], realExample: 'Retail: Adjust prices in 12 branches.', extra: 'Try: Ctrl + Select Jan, Feb, Mar' },
            'formatting': { t: 'Select All Sheets', d: 'Unified format.', p: ['Right Click Select All.', 'Format replicates.', 'Painter works.', 'Column Width too.'], s: 'Blue headers for all agents.', o: ['Select All & Format', 'Macro', 'One by one'], realExample: 'Bank: Unify report styles.', extra: 'Tip: Change BG color after selecting all' },
            'formulas': { t: '3D Formulas', d: 'One formula across tabs.', p: ['Sum(First:Last!Cell)', 'Sums same cell.', 'Works with Avg/Max.', 'Merged cells special.'], s: 'Sum Jan to Mar C18.', o: ['Jan+Feb+..', 'Sum(Jan:Mar!C18)', 'Consolidate'], realExample: 'Hospital: Yearly revenue track.', extra: 'Use =AVERAGE(Jan:Dec!B5)' },
            'safety': { t: 'Safety Warning', d: 'Don\'t Forget!', p: ['Ungroup when done.', 'Overwrite risk.', 'Check title bar.', 'Excel warns you.'], s: 'Edit Jan ONLY after group work.', o: ['Edit now', 'Ungroup First', 'Close'], realExample: 'Insurance: Data loss prevention.', extra: 'Watch for [Group] in title' },
            'comparison': { t: 'Comparisons', d: 'Comparing values.', p: ['Column: Vertical.', 'Bar: Long labels.', 'Contrast colors.', 'Data Labels.'], s: 'Compare 3 products.', o: ['Column', 'Line', 'Pie'], dataLabels: ['A','B','C'], realExample: 'E-com: Product comparison.', extra: 'Use Clustered Column for periods' },
            'trends': { t: 'Trends', d: 'Time based change.', p: ['Line: Ups/Downs.', 'Area: Volume.', 'Trendline.', 'Markers.'], s: 'Gold price 5 months.', o: ['Pie', 'Bar', 'Line'], dataLabels: ['Jan','Feb','Mar','Apr','May'], realExample: 'Stock: Yearly track.', extra: 'Click points for values' },
            'proportions': { t: 'Proportions', d: 'Part of whole.', p: ['Pie: %.', 'Max 7 slices.', 'Doughnut.', 'Explode slice.'], s: 'Budget Split.', o: ['Radar', 'Pie', 'Scatter'], dataLabels: ['Sal','Mkt','Ops'], realExample: 'Startup: Cap table.', extra: 'Pie of Pie for big data' },
            'relationships': { t: 'Relationships', d: 'Multi-criteria.', p: ['Radar: Skills.', 'Scatter: Correlation.', 'Bubble: 3D.', 'Heatmap: Density.'], s: 'Skill Eval.', o: ['Radar', 'Line', 'Column'], dataLabels: ['Com','Tec','Tem','Tim','Wok'], realExample: 'HR: Performance review.', extra: 'Drag points to interact' }
        };
        t.en.lessons = enLessons;

        const quizQs = {
            ar: [
                {t: 'ŸÉŸäŸÅ ÿ™ÿ≠ÿØÿØ ÿµŸÅÿ≠ÿßÿ™ ŸÖÿ™ŸÅÿ±ŸÇÿ©ÿü', o: ['Shift', 'Ctrl', 'Alt']},
                {t: 'ÿßŸÑŸÖÿπÿßÿØŸÑÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÑŸÑÿ¨ŸÖÿπ ÿ´ŸÑÿßÿ´Ÿä ÿßŸÑÿ£ÿ®ÿπÿßÿØÿü', o: ['Sum(Jan+Feb)', 'Sum(Jan:Mar!A1)', 'Sum(All!A1)']},
                {t: 'ÿ£Ÿä ÿ±ÿ≥ŸÖ Ÿäÿ≥ÿ™ÿÆÿØŸÖ ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÜÿ≥ÿ® ÿßŸÑŸÖÿ¶ŸàŸäÿ©ÿü', o: ['Line', 'Pie', 'Radar']},
                {t: 'ÿ£ŸÅÿ∂ŸÑ ÿ±ÿ≥ŸÖ ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ© ÿ®ŸäŸÜ ŸÅÿ¶ÿßÿ™ ÿ®ÿ£ÿ≥ŸÖÿßÿ° ÿ∑ŸàŸäŸÑÿ©ÿü', o: ['Bar (Horizontal)', 'Column', 'Scatter']}
            ],
            en: [
                {t: 'Select non-adjacent sheets?', o: ['Shift', 'Ctrl', 'Alt']},
                {t: 'Correct 3D Formula?', o: ['Sum(Jan+Feb)', 'Sum(Jan:Mar!A1)', 'Sum(All!A1)']},
                {t: 'Chart for percentages?', o: ['Line', 'Pie', 'Radar']},
                {t: 'Best chart for long labels?', o: ['Bar (Horizontal)', 'Column', 'Scatter']}
            ]
        };
        t.ar_male.quiz.qs = quizQs.ar;
        t.ar_female.quiz.qs = quizQs.ar;
        t.en.quiz.qs = quizQs.en;

        const SimText = {
             ar: { item: 'ÿµŸÜŸÅ', qty: 'ŸÉŸÖŸäÿ©', sales: 'ŸÖÿ®Ÿäÿπÿßÿ™', total: 'ŸÖÿ¨ŸÖŸàÿπ', editWarn: 'ÿ™ŸÜÿ®ŸäŸá: ÿ™ÿπÿØŸäŸÑ Jan ŸÅŸÇÿ∑', noFormat: 'ÿ®ÿØŸàŸÜ ÿ™ŸÜÿ≥ŸäŸÇ ŸÖŸàÿ≠ÿØ', safe: 'ÿ¢ŸÖŸÜ: Jan ŸÅŸÇÿ∑', warn: 'ÿÆÿ∑ÿ±: ÿ™ÿπÿØŸäŸÑ ÿ¨ŸÖÿßÿπŸä', multiSelect: 'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿµŸÅÿ≠ÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ©', groupMode: 'Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿ¨ŸÖŸäÿπ ŸÜÿ¥ÿ∑' },
             en: { item: 'Item', qty: 'Qty', sales: 'Sales', total: 'Total', editWarn: 'Editing Jan Only!', noFormat: 'No Global Format', safe: 'Safe: Jan Only', warn: 'Warning: All Sheets Edited!', multiSelect: 'Multiple Sheets Selected', groupMode: 'Group Mode Active' }
        };

        const lessonsConfig = {
            'grouping': { type: 'excel', visual: 'grouping', correct: 'opt2', optionsIcons: ['copy', 'layers', 'edit'] },
            'formatting': { type: 'excel', visual: 'formatting', correct: 'opt1', optionsIcons: ['paint-bucket', 'code', 'check'] },
            'formulas': { type: 'excel', visual: '3dsum', correct: 'opt2', optionsIcons: ['plus', 'sigma', 'database'] },
            'safety': { type: 'excel', visual: 'ungroup', correct: 'opt2', optionsIcons: ['edit', 'unlock', 'x'] },
            'comparison': { type: 'chart', visual: 'column', correct: 'column', data: {d:[120,190,80]}, optionsIcons: ['bar-chart', 'trending-up', 'pie-chart'], optionIds: ['column', 'line', 'pie'] },
            'trends': { type: 'chart', visual: 'line', correct: 'line', data: {d:[1800,1820,1790,1850,1900]}, optionsIcons: ['pie-chart', 'align-left', 'trending-up'], optionIds: ['pie', 'bar', 'line'] },
            'proportions': { type: 'chart', visual: 'pie', correct: 'pie', data: {d:[50,30,20]}, optionsIcons: ['hexagon', 'pie-chart', 'scatter'], optionIds: ['radar', 'pie', 'scatter'] },
            'relationships': { type: 'chart', visual: 'radar', correct: 'radar', data: {d:[80,90,70,85,60]}, optionsIcons: ['hexagon', 'trending-up', 'bar-chart'], optionIds: ['radar', 'line', 'column'] }
        };

        const chartConfig = { column: {type:'bar'}, bar: {type:'bar', indexAxis:'y'}, line: {type:'line'}, pie: {type:'pie'}, radar: {type:'radar'}, scatter: {type:'scatter'} };

        function init() {
            lucide.createIcons();
            document.getElementById('auth-modal').style.display = 'flex';
            updateModalTexts();

            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('username-input').value.trim();
                if(name) {
                    state.userName = name;
                    document.getElementById('auth-modal').style.display = 'none';
                    document.getElementById('cert-name').textContent = name;
                    
                    const userDisplay = document.getElementById('user-display');
                    const iconName = state.gender === 'female' ? 'user-circle' : 'user';
                    const colorClass = state.gender === 'female' ? 'text-pink-600' : 'text-blue-600';
                    userDisplay.innerHTML = `<i data-lucide="${iconName}" class="w-4 h-4 ${colorClass}"></i> <span class="font-bold text-sm ${colorClass}">${name}</span>`;
                    
                    showToast(`Ÿäÿß ŸáŸÑÿß ${name}!`, 'success');
                    renderNav();
                    renderContent('hero');
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    addAchievement('firstBlood');
                }
            });
            document.getElementById('cert-date').textContent = new Date().toLocaleDateString('en-GB');
            updateLeaderboard();
        }

        function selectGender(type) {
            state.gender = type;
            document.querySelectorAll('.gender-option').forEach(el => el.classList.remove('selected'));
            document.querySelector(`.gender-option[data-type="${type}"]`).classList.add('selected');
            updateModalTexts();
        }

        function updateModalTexts() {
            const T = getContent();
            document.querySelector('#auth-modal h2').textContent = T.modal.t;
            document.querySelector('#auth-modal p').textContent = T.modal.d;
            document.querySelector('#start-btn-text').textContent = T.modal.b;
            
            const h2 = document.querySelector('#auth-modal h2');
            if(state.lang === 'ar' && state.gender === 'female') {
                h2.classList.add('text-pink-600'); h2.classList.remove('text-gray-800');
            } else {
                h2.classList.remove('text-pink-600'); h2.classList.add('text-gray-800');
            }
        }

        function getContent() {
            if(state.lang === 'en') return t.en;
            return state.gender === 'female' ? t.ar_female : t.ar_male;
        }

        function toggleLanguage() {
            state.lang = state.lang === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = state.lang;
            document.documentElement.dir = state.lang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').textContent = state.lang === 'ar' ? 'EN' : 'AR';
            updateModalTexts(); // Added this to update modal text if language toggled
            renderNav();
            renderContent(state.currentSection);
        }

        function renderNav() {
            const T = getContent();
            const nav = document.getElementById('nav-menu');
            nav.innerHTML = '';
            
            const createBtn = (id, title, icon) => {
                const active = state.currentSection === id;
                const done = state.completedSections.has(id);
                return `<button onclick="renderContent('${id}'); if(window.innerWidth<1024) document.getElementById('mobile-menu-content').classList.add('hidden')" class="w-full text-start px-4 py-3 rounded-xl mb-1 flex justify-between transition ${active ? 'active-nav' : 'hover:bg-gray-50 text-gray-700'}">
                    <span class="flex gap-2 items-center"><i data-lucide="${icon}" class="w-4"></i> ${title}</span>
                    ${done ? '<i data-lucide="check-circle-2" class="w-4 text-green-500"></i>' : ''}
                </button>`;
            };

            nav.innerHTML += createBtn('hero', T.nav.hero, 'home');
            nav.innerHTML += `<div class="text-xs font-bold text-gray-400 mt-4 mb-2 uppercase px-2">${T.nav.p1}</div>`;
            ['grouping', 'formatting', 'formulas', 'safety'].forEach(k => nav.innerHTML += createBtn(k, T.lessons[k].t, 'sheet'));
            nav.innerHTML += `<div class="text-xs font-bold text-gray-400 mt-4 mb-2 uppercase px-2">${T.nav.p2}</div>`;
            ['comparison', 'trends', 'proportions', 'relationships'].forEach(k => nav.innerHTML += createBtn(k, T.lessons[k].t, 'bar-chart-2'));
            nav.innerHTML += `<div class="my-2 border-t border-gray-200"></div>`;
            nav.innerHTML += createBtn('quiz', T.nav.quiz, 'award');
            
            updateProgressUI();
            updateAchievements();
            lucide.createIcons();
        }

        function updateProgressUI() {
            const pct = Math.round((state.completedSections.size / 9) * 100);
            const offset = (2 * Math.PI * 45) * (1 - pct/100);
            document.getElementById('progress-ring').style.strokeDashoffset = offset;
            document.getElementById('progress-percent').textContent = pct + '%';
            document.getElementById('progress-label').textContent = getContent().common.progress;
            
            if(state.completedSections.size > 0) {
                state.xp = state.completedSections.size * 100;
                document.getElementById('xp-value').textContent = state.xp;
                document.getElementById('xp-display').classList.remove('hidden');
            }
        }

        function renderContent(key) {
            state.currentSection = key;
            state.tempSelection = null;
            const container = document.getElementById('content-area');
            const T = getContent();
            
            container.classList.remove('animate-slide-in');
            void container.offsetWidth;
            container.classList.add('animate-slide-in');

            if(key === 'hero') {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="flex justify-center gap-4 mb-6 animate-bounce">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-x-primary"><i data-lucide="sheet" class="w-8 h-8"></i></div>
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center text-x-secondary"><i data-lucide="pie-chart" class="w-8 h-8"></i></div>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-black mb-2 text-gray-900">${T.hero.title}</h1>
                        <h2 class="text-xl md:text-2xl text-x-primary font-bold mb-4">${T.hero.sub}</h2>
                        <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">
                            ${T.hero.welcome} <span class="text-x-primary font-bold badge px-2 py-1 rounded bg-green-50">${state.userName||''}</span>, ${T.hero.desc}
                        </p>
                        <button onclick="renderContent('grouping')" class="bg-x-primary hover:bg-x-primary-dark text-white font-bold py-3 px-10 rounded-xl shadow-lg transition hover:scale-105 flex items-center justify-center gap-2 mx-auto">
                            ${T.hero.btn} <i data-lucide="${state.lang==='ar'?'arrow-left':'arrow-right'}"></i>
                        </button>
                        <div class="grid md:grid-cols-3 gap-6 mt-12 text-start">
                            ${[1,2,3].map(i => `
                                <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100 hover:border-x-primary transition hover:shadow-lg">
                                    <div class="w-10 h-10 rounded-lg bg-white shadow-sm flex items-center justify-center mb-3">
                                        <i data-lucide="${i===1?'layers':i===2?'bar-chart-3':'award'}" class="w-5 h-5 text-x-primary"></i>
                                    </div>
                                    <h3 class="font-bold text-gray-800 mb-1">${T.hero['f'+i]}</h3>
                                    <p class="text-xs text-gray-500">${T.hero['f'+i+'d']}</p>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-8">
                            <button onclick="document.getElementById('leaderboard-modal').style.display='flex'" class="text-sm font-bold text-gray-500 hover:text-x-secondary underline flex items-center justify-center gap-1 mx-auto">
                                <i data-lucide="trophy" class="w-4"></i> ${T.hero.leaderboard}
                            </button>
                        </div>
                    </div>`;
            } else if (key === 'quiz') {
                renderQuiz(container);
            } else {
                renderLessonUI(container, key);
            }
            lucide.createIcons();
        }

        function renderLessonUI(container, key) {
            const T = getContent();
            const L = T.lessons[key];
            const C = lessonsConfig[key];
            const isDone = state.completedSections.has(key);

            const optionsHTML = L.o.map((optText, idx) => {
                const optId = C.type === 'chart' ? C.optionIds[idx] : `opt${idx+1}`;
                const icon = C.optionsIcons[idx];
                const isCorrect = (C.type === 'excel' && `opt${idx+1}` === C.correct) || (C.type === 'chart' && optId === C.correct);
                
                return `
                    <button onclick="selectOption('${key}', '${optId}')" id="btn-${optId}" 
                           class="option-btn w-full flex items-center gap-4 p-4 rounded-xl border border-gray-200 hover:shadow-md transition bg-white
                                  ${isDone && isCorrect ? 'ring-2 ring-green-500 bg-green-50' : ''}">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600">
                            <i data-lucide="${icon}" class="w-5 h-5"></i>
                        </div>
                        <div class="flex-1 text-start">
                            <span class="font-bold text-gray-700">${optText}</span>
                        </div>
                    </button>`;
            }).join('');

            container.innerHTML = `
                <div class="max-w-5xl mx-auto space-y-6">
                    <div class="border-b border-gray-100 pb-4">
                        <span class="text-x-primary font-bold text-xs uppercase bg-green-50 px-2 py-1 rounded-md">${T.common.lesson}</span>
                        <h2 class="text-3xl font-black mt-2 text-gray-900">${L.t}</h2>
                        <p class="text-gray-500">${L.d}</p>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                                <h3 class="font-bold text-blue-800 mb-3 flex items-center gap-2"><i data-lucide="book-open" class="w-4"></i> ${T.common.learn}</h3>
                                <ul class="space-y-2 text-sm text-gray-700">
                                    ${L.p.map(p => `<li class="flex items-start gap-2"><i data-lucide="check" class="w-4 h-4 text-blue-500 mt-1"></i> ${p}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2"><i data-lucide="target" class="w-4"></i> ${T.common.scenario}</h4>
                                <p class="text-sm bg-amber-50 p-4 rounded-xl border border-amber-100 text-gray-700 italic">${L.s}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-3">${T.common.choose}</h4>
                                <div class="space-y-3" id="options-${key}">${optionsHTML}</div>
                            </div>
                            
                            <div id="extra-${key}" class="hidden space-y-4 pt-4 animate-slide-in">
                                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                                    <h5 class="font-bold text-green-800 text-xs mb-1 flex gap-1"><i data-lucide="briefcase" class="w-3"></i> ${T.common.realExample}</h5>
                                    <p class="text-xs text-gray-700">${L.realExample}</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
                                    <h5 class="font-bold text-purple-800 text-xs mb-1 flex gap-1"><i data-lucide="zap" class="w-3"></i> ${T.common.extraTip}</h5>
                                    <p class="text-xs text-gray-700">${L.extra}</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-2xl p-4 border border-gray-200 flex flex-col h-[500px]">
                            <div class="bg-white px-4 py-2 rounded-t-xl border-b border-gray-100 flex justify-between items-center text-xs font-bold text-gray-400">
                                <span>${C.type === 'excel' ? 'Excel Simulator' : 'Chart Preview'}</span>
                                <div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-red-300"></div><div class="w-2 h-2 rounded-full bg-yellow-300"></div><div class="w-2 h-2 rounded-full bg-green-300"></div></div>
                            </div>
                            <div id="visual-${key}" class="flex-grow bg-white relative p-4 flex items-center justify-center overflow-hidden">
                                <div id="placeholder-${key}" class="text-center text-gray-300 ${isDone?'hidden':''}">
                                    <i data-lucide="layout-grid" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                    <p class="text-sm">${T.common.placeholder}</p>
                                </div>
                                ${C.type === 'excel' ? `<div id="excel-content-${key}" class="w-full h-full hidden text-xs"></div>` : `<canvas id="canvas-${key}" class="hidden w-full h-full"></canvas>`}
                            </div>
                            <div id="actions-${key}" class="pt-4 border-t border-gray-200 flex justify-end gap-3 ${isDone?'hidden':''}">
                                <button onclick="verify('${key}')" id="verify-${key}" class="bg-x-secondary hover:bg-yellow-500 text-gray-900 px-6 py-2 rounded-lg font-bold shadow-md transition text-sm flex items-center gap-2">
                                    ${T.common.check} <i data-lucide="check"></i>
                                </button>
                            </div>
                             <button onclick="nextLesson('${key}')" id="next-${key}" class="w-full mt-4 hidden bg-x-primary text-white px-6 py-3 rounded-lg font-bold shadow-md transition text-sm flex items-center justify-center gap-2 animate-pulse">
                                ${T.common.next} <i data-lucide="${state.lang==='ar'?'arrow-left':'arrow-right'}"></i>
                            </button>
                        </div>
                    </div>
                </div>`;
            
            if(isDone) {
                 document.getElementById(`extra-${key}`).classList.remove('hidden');
                 document.getElementById(`next-${key}`).classList.remove('hidden');
                 document.getElementById(`next-${key}`).classList.add('flex');
                 selectOption(key, C.correct === 'opt2' && C.type === 'excel' ? 'opt2' : (C.type==='chart' ? C.correct : 'opt1'), true);
            }
        }

        function selectOption(key, optId, noAnim) {
            state.tempSelection = optId;
            const config = lessonsConfig[key];
            
            document.querySelectorAll(`#options-${key} button`).forEach(b => {
                b.classList.remove('ring-4', 'ring-blue-200', 'bg-blue-50');
            });
            document.getElementById(`btn-${optId}`).classList.add('ring-4', 'ring-blue-200', 'bg-blue-50');

            document.getElementById(`placeholder-${key}`).classList.add('hidden');
            if (config.type === 'excel') {
                document.getElementById(`excel-content-${key}`).classList.remove('hidden');
                renderExcelGrid(key, config.visual, optId === config.correct);
            } else {
                document.getElementById(`canvas-${key}`).classList.remove('hidden');
                renderChart(key, optId);
            }
        }

        let currentChart = null;
        function renderChart(key, optId) {
            const ctx = document.getElementById(`canvas-${key}`).getContext('2d');
            if(currentChart) currentChart.destroy();
            
            const config = lessonsConfig[key];
            const L = getContent().lessons[key];
            const typeMap = { column: 'bar', bar: 'bar', line: 'line', pie: 'pie', radar: 'radar', scatter: 'scatter' };
            const type = typeMap[optId] || 'bar';
            const indexAxis = optId === 'bar' ? 'y' : 'x';
            
            currentChart = new Chart(ctx, {
                type: type,
                data: {
                    labels: L.dataLabels,
                    datasets: [{
                        label: 'Data',
                        data: config.data.d,
                        backgroundColor: ['#107c41', '#fbbf24', '#3b82f6', '#ec4899', '#ef4444'],
                        borderColor: '#0b5c30',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: indexAxis,
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function renderExcelGrid(key, type, isCorrect) {
            const el = document.getElementById(`excel-content-${key}`);
            const S = state.lang === 'ar' ? SimText.ar : SimText.en;
            
            let content = '';
            const style = isCorrect ? "border-green-500 bg-green-50" : "border-red-300";
            
            if(type === 'grouping' || type === '3dsum') {
                content = `
                <div class="flex flex-col gap-2 h-full justify-center items-center">
                    <div class="w-full bg-gray-200 p-2 rounded flex gap-1 font-mono text-[10px] md:text-xs">
                         <span class="font-bold text-gray-500">fx</span>
                         <span class="bg-white flex-1 px-1 rounded ${isCorrect ? 'text-green-600 font-bold' : ''}">${isCorrect ? (type==='3dsum'?'=SUM(Jan:Mar!C5)':'Total') : '...'}</span>
                    </div>
                    <div class="border-2 ${style} rounded w-full flex-1 flex items-center justify-center relative bg-white">
                        ${isCorrect ? 
                            `<div class="text-center animate-pop"><i data-lucide="check-circle" class="w-8 h-8 text-green-500 mx-auto"></i><p class="font-bold text-green-700">${S.multiSelect}</p></div>` : 
                            `<div class="text-center"><i data-lucide="alert-triangle" class="w-8 h-8 text-gray-300 mx-auto"></i><p class="text-gray-400">${S.editWarn}</p></div>`
                        }
                    </div>
                    <div class="flex gap-1 w-full overflow-hidden">
                        ${['Jan','Feb','Mar'].map(t => `<div class="bg-gray-200 px-3 py-1 rounded-t text-[10px] ${isCorrect?'bg-white border-b-2 border-green-500 text-green-700 font-bold':''}">${t}</div>`).join('')}
                    </div>
                </div>`;
            } else {
                content = `<div class="h-full flex items-center justify-center border-2 ${style} rounded bg-white text-center p-4">
                    ${isCorrect ? `<div class="text-green-600 font-bold animate-pop">Done! üéâ</div>` : `<div class="text-gray-400">${S.noFormat}</div>`}
                </div>`;
            }
            el.innerHTML = content;
            lucide.createIcons();
        }

        function verify(key) {
            const config = lessonsConfig[key];
            if(state.tempSelection === config.correct || (config.type==='chart' && state.tempSelection === config.correct)) {
                if(!state.completedSections.has(key)) {
                    state.completedSections.add(key);
                    showToast(getContent().common.correct, 'success');
                    confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });
                    document.getElementById(`extra-${key}`).classList.remove('hidden');
                    document.getElementById(`next-${key}`).classList.remove('hidden');
                    document.getElementById(`next-${key}`).classList.add('flex');
                    document.getElementById(`verify-${key}`).classList.add('hidden');
                    
                    document.getElementById(`btn-${state.tempSelection}`).classList.replace('ring-blue-200', 'ring-green-500');
                    document.getElementById(`btn-${state.tempSelection}`).classList.replace('bg-blue-50', 'bg-green-50');
                    
                    checkAchievements();
                }
            } else {
                showToast(getContent().common.wrong, 'error');
                const btn = document.getElementById(`btn-${state.tempSelection}`);
                if(btn) {
                    btn.classList.add('animate-shake', 'ring-red-300', 'bg-red-50');
                    setTimeout(() => btn.classList.remove('animate-shake', 'ring-red-300', 'bg-red-50'), 500);
                }
            }
        }

        function nextLesson(curr) {
            const keys = ['hero', ...Object.keys(lessonsConfig), 'quiz'];
            const idx = keys.indexOf(curr);
            if(idx < keys.length-1) renderContent(keys[idx+1]);
        }

        function renderQuiz(container) {
            const Q = getContent().quiz;
            container.innerHTML = `
                <div class="max-w-2xl mx-auto py-6">
                    <h2 class="text-3xl font-black text-center mb-8">${Q.t}</h2>
                    <div class="space-y-4">
                        ${Q.qs.map((q, i) => `
                            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                                <p class="font-bold mb-3">${i+1}. ${q.t}</p>
                                <div class="space-y-2">
                                    ${q.o.map(opt => `
                                        <label class="flex items-center gap-3 p-3 bg-white rounded-lg border cursor-pointer hover:border-x-primary">
                                            <input type="radio" name="q${i}" value="${opt}" class="accent-x-primary w-4 h-4">
                                            <span class="text-sm">${opt}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="submitQuiz()" class="w-full mt-8 bg-x-primary text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition">${getContent().common.submit}</button>
                </div>
            `;
        }

        function submitQuiz() {
            let score = 0;
            for(let i=0; i<4; i++) {
                if(document.querySelector(`input[name="q${i}"]:checked`)) score++;
            }
            
            if(score >= 3) {
                state.completedSections.add('quiz');
                confetti({ particleCount: 200, spread: 100 });
                document.getElementById('certificate-modal').style.display = 'flex';
                document.getElementById('cert-header').textContent = getContent().common.cert.h;
                document.getElementById('cert-sub').textContent = getContent().common.cert.s;
                document.getElementById('cert-desc').textContent = getContent().common.cert.d;
                if(score === 4) addAchievement('perfectScore');
            } else {
                showToast(`ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ${score}/4 - ${getContent().common.wrong}`, 'error');
            }
        }

        function updateAchievements() {
            const list = document.getElementById('achievements-list');
            const section = document.getElementById('achievements-section');
            if(state.achievements.size > 0) {
                section.classList.remove('hidden');
                list.innerHTML = Array.from(state.achievements).map(id => {
                    const A = getContent().common.achievements[id];
                    return `<div class="flex items-center gap-2 p-2 bg-yellow-50 rounded-lg border border-yellow-100 text-yellow-800">
                        <i data-lucide="medal" class="w-4 h-4"></i>
                        <div><div class="font-bold text-xs">${A.name}</div><div class="text-[10px]">${A.desc}</div></div>
                    </div>`;
                }).join('');
            }
        }

        function addAchievement(id) {
            if(!state.achievements.has(id)) {
                state.achievements.add(id);
                showToast(`üèÜ ÿ•ŸÜÿ¨ÿßÿ≤ ÿ¨ÿØŸäÿØ: ${getContent().common.achievements[id].name}`, 'success');
                updateAchievements();
            }
        }

        function checkAchievements() {
            const excelDone = ['grouping','formatting','formulas','safety'].every(k => state.completedSections.has(k));
            if(excelDone) addAchievement('excelMaster');
            
            const chartsDone = ['comparison','trends','proportions','relationships'].every(k => state.completedSections.has(k));
            if(chartsDone) addAchievement('chartWizard');
        }

        function updateLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            const names = ['ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ', 'ÿ≥ÿßÿ±ÿ© ÿπŸÑŸä', 'ÿÆÿßŸÑÿØ ÿ≠ÿ≥ŸÜ', 'ŸÑŸäŸÑŸâ ÿπŸÖÿ±'];
            list.innerHTML = names.map((n, i) => `
                <div class="flex justify-between items-center p-3 rounded-lg ${i===0?'bg-yellow-50 border border-yellow-200':(i===1?'bg-gray-50 border border-gray-200':'')}">
                    <div class="flex items-center gap-3">
                        <div class="font-bold text-gray-400">#${i+1}</div>
                        <div class="font-bold text-gray-700">${n}</div>
                    </div>
                    <div class="font-mono font-bold text-x-primary">${950 - (i*50)} XP</div>
                </div>
            `).join('');
            
            document.getElementById('user-rank').textContent = '#42';
            document.getElementById('user-score-display').querySelector('p:last-child').textContent = state.xp;
        }

        function showToast(m, type) {
            const el = document.createElement('div'); 
            el.className = `toast ${type}`;
            el.innerHTML = type === 'success' 
                ? `<i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i> ${m}` 
                : `<i data-lucide="x-circle" class="w-5 h-5 text-red-500"></i> ${m}`;
            
            const container = document.getElementById('toast-container');
            container.appendChild(el); 
            lucide.createIcons();
            
            setTimeout(() => el.classList.add('show'), 10);
            setTimeout(() => {
                el.classList.remove('show');
                setTimeout(() => el.remove(), 400);
            }, 3000);
        }

        function downloadCertificate() {
            const el = document.getElementById('certificate-content');
            html2canvas(el, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Certificate_${state.userName}.png`;
                link.href = canvas.toDataURL();
                link.click();
                showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ¥ŸáÿßÿØÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            });
        }

        window.onload = init;
    </script>
</body>
</html>
